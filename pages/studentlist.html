<!DOCTYPE html>
<html lang="en">


<head>
  <script>
    if (typeof module === 'object') {
      window.module = module;
      module = undefined;
    }
  </script>
  <!-- <script src="../node_modules/jquery/dist/jquery.min.js"></script> -->
  <script>
    if (window.module) module = window.module;
  </script>
  <link rel="stylesheet" href="../css/style.css">

  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans" />
  <title>Student List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans" />
  <script src ="../main.js"></script>
  <script>
    window.jQuery = window.$ = require('jquery');
  </script>
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->


</head>

<body>
  <div class="sidenav">
    <a href="studentlist.html" class="active">Student List</a>
    <a href="workplacelist.html">Workplace List</a>
    <button id = "assignbutton" onClick="assignAll()" >Assign</button>
  </div>

  <div class="main">
    <div class="container">
      <!-- Data table -->
      <div class="table-responsive">
        <h1 align="center">Student List</h1>
        <br />
        <div align="center">
          <button type="button" name="load_data" id="load_data" class="btn btn-info">Load Data</button>
        </div>
        <br />
        <input class="input" type="text" id="myInput" onkeyup="searchTable()" placeholder="Search by Student ID..." title="Type in an ID">
        <div class="rowStudents" id="parsed_csv_list">
          <div class="row" id="parsed_csv_list">
          </div>
          <div id="student_table">
          </div>
        </div>
      </div>
    </div>
</body>

</html>
<!-- Display the data in html table -->
<script>
  $(document).ready(function () {
    $('#load_data').click(function () {
      $.ajax({
        url: "../Students.csv",
        dataType: "text",
        success: function (data) {
          var employee_data = data.split(/\r?\n|\r/);
          var table_data = '<table class="table table-bordered table-striped" id="table">';
          var row = '<tr class = "clickable-row" name="load_page" onClick = "getTable()">'
          for (var count = 0; count < employee_data.length; count++) {
            var cell_data = employee_data[count].split(",");
            table_data += row;
            for (var cell_count = 0; cell_count < cell_data.length; cell_count++) {

              if (count === 0) {
                table_data += '<th>' + cell_data[cell_count] + '</th>';
              } else {
                table_data += '<td>' + cell_data[cell_count] + '</td>';
              }
            }
            table_data += '</tr>';
          }
          table_data += '</table>';
          $('#student_table').html(table_data);
        }
      });
    });
  });

 function getTable() {
      //Get list of rows in the table
      var table = document.getElementById("student_table");
      var rows = table.getElementsByTagName("tr");

      var selectedRow;

      //Row callback; reset the previously selected row and select the new one
      function SelectRow(row) {
          if (selectedRow !== undefined) {

              console.log(selectedRow.innerHTML);
              var studId = selectedRow.cells[0].innerHTML;
              console.log(studId);
              sendDetails(selectedRow.innerHTML);
          }
          selectedRow = row;

      }

      //Attach this callback to all rows
      for (var i = 0; i < rows.length; i++) {
          (function (idx) {
              addEvent(rows[idx], "click", function () {
                  SelectRow(rows[idx]);
              });
          })(i);
      }

      function addEvent(element, evt, callback) {
    if (element.addEventListener) {
        element.addEventListener(evt, callback, false);
    } else if (element.attachEvent) {
        element.attachEvent("on" + evt, callback);
    } else {
        element["on" + evt] = callback;
    }
}
  };

  function sendDetails(student) {
    var qs = "?stud=" + student;
    window.location.href="ViewStudentDetails.html" + qs;
  }

  function searchTable() {
    var input, filter, table, tr, td, i;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("student_table");
    tr = table.getElementsByTagName("tr");
    for (i = 0; i < tr.length; i++) {
      td = tr[i].getElementsByTagName("td")[0];
      if (td) {
        if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }
  }
</script>
